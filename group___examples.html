<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>DIY: Examples</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">DIY
   &#160;<span id="projectnumber">3.0</span>
   </div>
   <div id="projectbrief">data-parallel out-of-core C++ library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Examples</div>  </div>
</div><!--header-->
<div class="contents">
<p>The best way to learn DIY is by example, and the examples directory contains numerous complete programs that demonstrate most of the concepts in DIY. Example names preceded by the heading (<em>commented</em>) have ample comments embedded in the source code, meaning they are good starting points. The remaining, uncommented examples are easier to understand once the commented ones are clear.</p>
<ul>
<li><a href="https://github.com/diatomic/diy/tree/master/examples/simple">Simple</a>: includes common operations such as initializing DIY, adding links to form block neighborhoods, creating callback functions for each block, communicating between block neighbors, performing collectives over all blocks, and writing and reading blocks to and from a DIY file. These examples also show how to create, destroy, and serialize blocks in (<em>commented</em>) <a class="el" href="simple_2block_8h-example.html">block.h</a>.<ul>
<li>(<em>commented</em>) <a class="el" href="simple_2simple_8cpp-example.html">simple.cpp</a>: exercises simple neighbor communication by creating a linear chain of blocks, each connected to two neighbors (predecessor and successor), except for the first and the last blocks, which have only one or the other. Each block computes an average of its values and those of its neighbors. The average is stored in the block, and the blocks are written to a file in storage.</li>
<li><a class="el" href="simple_2until-done_8cpp-example.html">until-done.cpp</a>: shows how to use collectives in the DIY model, i.e., block-based collectives that can run in-/out-of-core and single/multithreaded. The same result can be accomplished using the reduction patterns in <a href="https://github.com/diatomic/diy/tree/master/examples/reduce">examples/reduce</a>, but using DIY collectives can be easier for simple "one-line" reductions such as global sums or boolean ands. This example shows how to do an <a class="el" href="group___communication.html#gabce4381d1244875967dc3d127227bd45">all_reduce()</a> in order to determine whether all blocks have finished processing.</li>
<li><a class="el" href="simple_2read-blocks_8cpp-example.html">read-blocks.cpp</a>: shows how to read a DIY file back into memory and create a new DIY master and assignment of blocks to processes that may be different than when the blocks were written. The blocks from <a class="el" href="simple_2simple_8cpp-example.html">simple.cpp</a> are read back into memory from the file, and their values are printed.</li>
</ul>
</li>
<li><a href="https://github.com/diatomic/diy/tree/master/examples/decomposition">Decomposition</a>: demonstrates how to decompose a regular grid into blocks and create links between them.<ul>
<li>(<em>commented</em>) <a class="el" href="decomposition_2regular-decomposer-long_8cpp-example.html">regular-decomposer-long.cpp</a>: blocks are defined via a lambda function provided to the decomposer. This example shows how to set shared faces, ghost regions, and periodic boundaries in the decomposition. It also shows both how to create a <code>RegularDecomposer</code> and call its <code>decompose</code> member function, as well as how to combine those two steps using one helper function.</li>
<li>(<em>commented</em>) <a class="el" href="decomposition_2regular-decomposer-short_8cpp-example.html">regular-decomposer-short.cpp</a>: domain can be decomposed just by providing a <code>Master</code> object to the decomposer.</li>
</ul>
</li>
<li><a href="https://github.com/diatomic/diy/tree/master/examples/serialization">Serialization</a>: blocks that are loaded and saved in and out of core are serialized by DIY. This example shows how to write the <code>load</code> and <code>save</code> functions for two data structures. Both require just a one-line definition because DIY can serialize such structures automatically.<ul>
<li><a class="el" href="serialization_2test-serialization_8cpp-example.html">test-serialization.cpp</a>: a 3-d <code>Point</code> and an n-d <code>PointVec</code> are serialized automatically, and the main program tests loading and saving both structures.</li>
</ul>
</li>
<li><a href="https://github.com/diatomic/diy/tree/master/examples/mpi">MPI</a>: shows DIY's <a class="el" href="group___m_p_i.html">convenience wrapper for MPI</a>. It exists only to make the code simpler; the user is free to use it or the original MPI routines interchangeably.<ul>
<li><a class="el" href="mpi_2test-mpi_8cpp-example.html">test-mpi.cpp</a>: this example exercises <code>send</code>, <code>receive</code>, <code>iprobe</code>, <code>broadcast</code>, <code>reduce</code>, <code>scan</code>, and <code>all_gather</code>.</li>
</ul>
</li>
<li><a href="https://github.com/diatomic/diy/tree/master/examples/io">I/O</a>: illustrates BOV (brick of values) and NumPy I/O, both built on top of MPI-IO and MPI sub-array types.<ul>
<li><a class="el" href="io_2test-io_8cpp-example.html">test-io.cpp</a>: tests the readers and writers for BOV and NumPy. The reader would typically be called from the <code>create</code> callback passed to <a class="el" href="group___decomposition.html#gada52dd59060aac8b76281bec95e5f099" title="Decomposes the domain into a prescribed pattern of blocks. ">diy::decompose</a> and tell the reader to read a specific block of data that the decomposer chose. Blocks can read data collectively if the number of blocks on each processor is the same. Same goes for the writers. The writer would typically be called from the <code>foreach</code> callback for each block.</li>
</ul>
</li>
<li><a href="https://github.com/diatomic/diy/tree/master/examples/reduce">Reduction</a>: DIY supports general reductions to implement more complex global operations than the collective one-liners. These reductions are general-purpose (any global communication pattern can be implemented); they operate over blocks, which cycle in and out of core as necessary; the operations are (multi-)threaded automatically using the same mechanism as foreach(). Although any global communication can be expressed using the reduction mechanism, all the reductions included in DIY operate in rounds over a k-ary reduction tree. The value of k used in each round can vary, but if it's fixed, the number of rounds is log_k(nblocks).<ul>
<li>(<em>commented</em>) <a class="el" href="reduce_2merge-reduce_8cpp-example.html">merge-reduce.cpp</a>: merges blocks together, computing a sum of their values. At each round, one block of a group of k blocks is the root of the group. The other blocks send their data to the root, which computes the sum, and the root block (only) proceeds to the next round. After <code>log_k(numblocks)</code> rounds, one block contains the global sum of the values. Calling merge-reduce is done by creating <code><a class="el" href="structdiy_1_1_regular_merge_partners.html" title="Partners for merge-reduce. ">diy::RegularMergePartners</a></code> and then calling <code><a class="el" href="group___communication.html#ga4254d5b9c3e97e5d5d73dd019023257f" title="Implementation of the reduce communication pattern (includes swap-reduce, merge-reduce, and any other global communication). ">diy::reduce</a></code>. For regular grids of blocks, groups can be formed by either "distance-doubling" or "distance-halving" depending on the value of the <code>contiguous</code> parameter in <code><a class="el" href="structdiy_1_1_regular_merge_partners.html" title="Partners for merge-reduce. ">diy::RegularMergePartners</a></code>.</li>
<li>(<em>commented</em>) <a class="el" href="reduce_2swap-reduce_8cpp-example.html">swap-reduce.cpp</a>: unlike merge-reduce, the swap-reduction does not idle blocks from one round to the next and does not aggregate all the results to a single block. Rather, block data are split into k pieces that are swapped between the k members of a group. This particular example begins with an unsorted set of points that do not lie in the bounds of the blocks, and the swap reduction is used to sort the points in the correct blocks with respect to the block bounds.</li>
<li><a class="el" href="reduce_2all-to-all_8cpp-example.html">all-to-all.cpp</a>: this example solves the same problem as <a class="el" href="reduce_2swap-reduce_8cpp-example.html">swap-reduce.cpp</a>: sorts points in blocks. The difference is that <a class="el" href="reduce_2swap-reduce_8cpp-example.html">swap-reduce.cpp</a> does everything manually; whereas in <a class="el" href="reduce_2all-to-all_8cpp-example.html">all-to-all.cpp</a>, the user only specifies how to enqueue data (from each block to each block) at the start and how to dequeue data at the end. <code><a class="el" href="group___communication.html#ga3dfb1bdb9c078d9f18fc6953295a0208" title="all to all reduction ">diy::all_to_all()</a></code> takes care of all the intermediate rounds, routing the data appropriately.</li>
<li>(<em>commented</em>) <a class="el" href="reduce_2all-done_8cpp-example.html">all-done.cpp</a>: this is another example of using <code><a class="el" href="group___communication.html#ga3dfb1bdb9c078d9f18fc6953295a0208" title="all to all reduction ">diy::all_to_all()</a></code> for a very common case: to determine globally whether any blocks have any local work left to do.</li>
<li><a class="el" href="reduce_2sort_8cpp-example.html">sort.cpp</a>: shows how to use reduction to sort a 1-d vector of integers. The algorithm is a histogram-based sort that combines both merge and swap reductions. It merges histograms of local data distributions, computes quantiles of the histograms, and then swaps data values among blocks based on the quantiles.</li>
</ul>
</li>
<li><a href="https://github.com/diatomic/diy/tree/master/examples/reduce">Algorithms</a>: Examples of the following algorithms are included.<ul>
<li><a class="el" href="reduce_2sample-sort_8cpp-example.html">sample-sort.cpp</a>: This example calls the parallel sample sort algorithm of [Blelloch 1998] that's included in DIY. The built-in <code><a class="el" href="group___algorithms.html#gad7301f5d7bb62b79ca679affdf874ace" title="sample sort values of each block, store the boundaries between blocks in samples ">diy::sort</a></code> used in this example is easier to use than the manual sort implemented by the example above, and we are in the process of comparing the performance of the two versions. Note that <a class="el" href="reduce_2sort_8cpp-example.html">sort.cpp</a> can only sort arithmetic types (to be able to compute the histograms), whereas <code><a class="el" href="group___algorithms.html#gad7301f5d7bb62b79ca679affdf874ace" title="sample sort values of each block, store the boundaries between blocks in samples ">diy::sort</a></code> supports any type, which has a user-supplied comparison operation.</li>
<li><a class="el" href="reduce_2kd-tree_8cpp-example.html">kd-tree.cpp</a>: Like the swap-reduce example above, this example begins with an unsorted set of points that do not lie in the bounds of any blocks, but the points are sorted into kd-tree of blocks with approximately equal numbers of points in each block.</li>
</ul>
</li>
</ul>
<p>Various other open-source projects have been DIY'ed, and these are also good, albeit more involved, places to learn DIY. Here are a few suggestions:</p>
<ul>
<li><a href="https://github.com/tpeterka/cian2">cian2</a> is a suite of benchmarks that test various HPC tasks. The <a href="https://github.com/tpeterka/cian2/communication">communication</a> part of cian tests common communication patterns including most of the above reductions and neighbor communication.</li>
<li><a href="https://github.com/diatomic/tess2">tess2</a> is a parallel Voronoi and Delaunay tessellation library that is parallelized using DIY.<ul>
<li>The <a href="https://github.com/diatomic/tess2/src">src</a> directory is the library code that uses DIY to compute the tessellation in parallel and write it to disk in the DIY block format.</li>
<li>The <a href="https://github.com/diatomic/tess2/examples">examples</a> directory contains numerous DIY programs that use the tess library.</li>
<li>The <a href="https://github.com/diatomic/tess2/tools">tools</a> directory contains a serial rendering program <code>draw.cpp</code> that reads the DIY block format from disk and uses it to draw the tessellation. </li>
</ul>
</li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Apr 16 2020 18:05:49 for DIY by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
