
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://example.com/reduce_comm/">
      
      
        <link rel="prev" href="../async_comm/">
      
      
        <link rel="next" href="../io/">
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.5">
    
    
      
        <title>Global communication (reductions) - DIY</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#merge-reduce" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="DIY" class="md-header__button md-logo" aria-label="DIY" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DIY
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Global communication (reductions)
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DIY" class="md-nav__button md-logo" aria-label="DIY" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    DIY
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../initialization/" class="md-nav__link">
        Initialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../decomposition/" class="md-nav__link">
        Domain decomposition
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../callbacks/" class="md-nav__link">
        Callback functions
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5" type="checkbox" id="__nav_5" checked>
      
      
      
        <label class="md-nav__link" for="__nav_5" tabindex="0" aria-expanded="true">
          Communication
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Communication" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Communication
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../local_comm/" class="md-nav__link">
        Local synchronous communication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../remote_comm/" class="md-nav__link">
        Remote communication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../async_comm/" class="md-nav__link">
        Asynchronous communication
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Global communication (reductions)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Global communication (reductions)
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#merge-reduce" class="md-nav__link">
    Merge-reduce
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#broadcast" class="md-nav__link">
    Broadcast
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#swap-reduce" class="md-nav__link">
    Swap-reduce
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#all-reduce" class="md-nav__link">
    All-reduce
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#all-to-all" class="md-nav__link">
    All-to-all
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        Block I/O
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../serialization/" class="md-nav__link">
        Serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../mpi/" class="md-nav__link">
        MPI convenience wrapper
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/" class="md-nav__link">
        Algorithms
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ooc/" class="md-nav__link">
        Writing out-of-core algorithms
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../threads/" class="md-nav__link">
        Automatic block threading
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        Examples
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#merge-reduce" class="md-nav__link">
    Merge-reduce
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#broadcast" class="md-nav__link">
    Broadcast
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#swap-reduce" class="md-nav__link">
    Swap-reduce
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#all-reduce" class="md-nav__link">
    All-reduce
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#all-to-all" class="md-nav__link">
    All-to-all
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Global communication (reductions)</h1>

<p>DIY supports general reductions to implement complex global operations over blocks.  These reductions are
general-purpose (any global communication pattern can be implemented); they operate over blocks, which cycle in and
out-of-core as necessary; the operations are (multi-)threaded automatically using the same mechanism as <code>foreach()</code>.</p>
<p>All the reductions included in DIY
operate in rounds over a k-ary reduction tree. The value of k used in each round can vary, but if it's fixed, the number
of rounds is log_k(nblocks). In each round of the reduction tree, the distance between blocks (in terms of their block
global ID or <code>gid</code>) either increases (so-called "distance-doubling") or decreases (so-called "distance-halving"). This
is controlled by the <code>contiguous</code> argument, which defaults to <code>true</code> (distance-doubling).
Only blocks decomposed by a <code>diy::RegularDecomposer</code> (i.e., blocks arranged in a regular block grid) can be reduced this
way. The decomposer object is one of the arguments to the reduction.</p>
<p>The following patterns are currently available. With the exception of <code>all_to_all</code>, the other patterns all feature a
call to <code>diy::reduce</code>, passing a derived class of <code>diy::RegularPartners</code> to differentiate between the different
patterns. The callback function passed to <code>diy::reduce</code> is similar to the callback function used with
<code>diy::Master:foreach</code> described in the <a href="../callbacks/">Callbacks page</a>. The callback function is called by DIY in each
round of the reduction tree. Each time, the communication proxy (<code>ReduceProxy</code>) acts similarly as in <code>foreach</code>: the
proxy contains the neighboring blocks that form a communicating group for the current round. Unlike <code>foreach</code>, this
group changes from one round to the next in a reduction. In addition to a pointer to the block and the communication
proxy, the callback is given the partners class, which can provide additional information. The user needs to write the
body of the callback function, which typically dequeues received messages from the previous round, performs some local
computation, and enqeues messages for the next round.</p>
<h2 id="merge-reduce">Merge-reduce</h2>
<p>A merge-reduce accumulates information in successively fewer blocks with each round. Each round, one block in a
communicating group (<code>ReduceProxy</code>) takes ownership of the merged result and continues to the next round, while the other
blocks in the group idle in the following rounds. In the final round, one block, the root of the reduction tree,
has all of the data.</p>
<!---
The figure below illustrates the first two rounds of a reduction of 16 blocks. The first round uses radix 4 while the
second round uses radix 2.

![Merge-reduce](figs/merge-reduce.png)
--->

<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">Block</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w">                                  </span><span class="c1">// local block</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="n">diy</span><span class="o">::</span><span class="n">ReduceProxy</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rp</span><span class="p">,</span><span class="w">                </span><span class="c1">// communication proxy</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="n">diy</span><span class="o">::</span><span class="n">RegularMergePartners</span><span class="o">&amp;</span><span class="p">)</span><span class="w">          </span><span class="c1">// partners of the current block</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="p">{</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="c1">// dequeue and merge</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">rp</span><span class="p">.</span><span class="n">in_link</span><span class="p">().</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">nbr_gid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rp</span><span class="p">.</span><span class="n">in_link</span><span class="p">().</span><span class="n">target</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">gid</span><span class="p">;</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="w">    </span><span class="n">in_vals</span><span class="p">;</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">        </span><span class="n">rp</span><span class="p">.</span><span class="n">dequeue</span><span class="p">(</span><span class="n">nbr_gid</span><span class="p">,</span><span class="w"> </span><span class="n">in_vals</span><span class="p">);</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">        </span><span class="c1">// merge with current block data, e.g., accumulate sum</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">in_vals</span><span class="p">.</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">j</span><span class="p">)</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">            </span><span class="p">(</span><span class="n">b</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">)[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">in_vals</span><span class="p">[</span><span class="n">j</span><span class="p">];</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
<a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">    </span><span class="c1">// step 2: enqueue</span>
<a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">rp</span><span class="p">.</span><span class="n">out_link</span><span class="p">().</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w">    </span><span class="c1">// redundant since out_link size = 1 for merge-reduce</span>
<a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">        </span><span class="n">rp</span><span class="p">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">rp</span><span class="p">.</span><span class="n">out_link</span><span class="p">().</span><span class="n">target</span><span class="p">(</span><span class="n">i</span><span class="p">),</span><span class="w"> </span><span class="n">b</span><span class="o">-&gt;</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="p">}</span>
<a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span>
<a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="p">{</span>
<a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">k</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w">                                       </span><span class="c1">// the radix of the k-ary reduction tree</span>
<a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="w">    </span><span class="c1">// partners for merge over regular block grid</span>
<a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="w">    </span><span class="n">diy</span><span class="o">::</span><span class="n">RegularMergePartners</span><span class="w">  </span><span class="n">partners</span><span class="p">(</span><span class="n">decomposer</span><span class="p">,</span><span class="w">  </span><span class="c1">// diy::Decomposer object</span>
<a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="w">                                        </span><span class="n">k</span><span class="p">,</span><span class="w">           </span><span class="c1">// radix of k-ary reduction (default 2)</span>
<a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="w">                                        </span><span class="n">contiguous</span><span class="p">);</span><span class="w"> </span><span class="c1">// contiguous = true: distance doubling (default true)</span>
<a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a><span class="w">                                                     </span><span class="c1">// contiguous = false: distance halving</span>
<a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a>
<a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="w">    </span><span class="c1">// reduction</span>
<a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="w">    </span><span class="n">diy</span><span class="o">::</span><span class="n">reduce</span><span class="p">(</span><span class="n">master</span><span class="p">,</span><span class="w">                              </span><span class="c1">// diy::Master object</span>
<a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="w">                </span><span class="n">assigner</span><span class="p">,</span><span class="w">                            </span><span class="c1">// diy::Assigner object</span>
<a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="w">                </span><span class="n">partners</span><span class="p">,</span><span class="w">                            </span><span class="c1">// diy::RegularMergePartners object</span>
<a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="w">                </span><span class="o">&amp;</span><span class="n">foo</span><span class="p">);</span><span class="w">                               </span><span class="c1">// merge operator callback function</span>
<a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-0-39" name="__codelineno-0-39" href="#__codelineno-0-39"></a><span class="p">}</span>
</code></pre></div>
<p><a href="https://github.com/diatomic/diy/blob/master/examples/reduce/merge-reduce.cpp">see the example here</a></p>
<h2 id="broadcast">Broadcast</h2>
<p>A broadcast is implemented as a merge-reduce in reverse order. Starting with one block, each round features more blocks
participating in the communication. The usage is similar to merge-reduce, with the partners object now being
`diy::RegularBroadcastPartners'.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">Block</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w">                                      </span><span class="c1">// local block</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="n">diy</span><span class="o">::</span><span class="n">ReduceProxy</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rp</span><span class="p">,</span><span class="w">                    </span><span class="c1">// communication proxy</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="n">diy</span><span class="o">::</span><span class="n">RegularBroadcastPartners</span><span class="o">&amp;</span><span class="p">);</span><span class="w">         </span><span class="c1">// partners of the current block</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="p">{</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="c1">// partners for broadcast over regular block grid</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">    </span><span class="n">diy</span><span class="o">::</span><span class="n">RegularBroadcastPartners</span><span class="w"> </span><span class="n">partners</span><span class="p">(</span><span class="n">decomposer</span><span class="p">,</span><span class="w">  </span><span class="c1">// diy::Decomposer object</span>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">                                           </span><span class="n">k</span><span class="p">,</span><span class="w">           </span><span class="c1">// radix of k-ary reduction (default 2)</span>
<a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w">                                           </span><span class="n">contiguous</span><span class="p">);</span><span class="w"> </span><span class="c1">// contiguous = true: distance doubling (default true)</span>
<a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">                                                        </span><span class="c1">// contiguous = false: distance halving</span>
<a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>
<a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">    </span><span class="c1">// reduction</span>
<a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">    </span><span class="n">diy</span><span class="o">::</span><span class="n">reduce</span><span class="p">(</span><span class="n">master</span><span class="p">,</span><span class="w">                                 </span><span class="c1">// diy::Master object</span>
<a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">                </span><span class="n">assigner</span><span class="p">,</span><span class="w">                               </span><span class="c1">// diy::Assigner object</span>
<a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">                </span><span class="n">partners</span><span class="p">,</span><span class="w">                               </span><span class="c1">// diy::RegularBroadcastPartners object</span>
<a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">                </span><span class="o">&amp;</span><span class="n">foo</span><span class="p">);</span><span class="w">                                  </span><span class="c1">// broadcast operator callback function</span>
<a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="p">}</span>
</code></pre></div>
<h2 id="swap-reduce">Swap-reduce</h2>
<p>Unlike a merge-reduce, the idea of a swap-reduce is to keep all blocks busy in all rounds. Typically data are
split and swapped among the neighboring blocks in each round, but the actual operations performed
are up to the user to write in the callback function. DIY's role in the swap-reduce is to provide different neighbors in
each round to the callback function, and to keep all blocks participating in all rounds. The usage is similar to
the the prior examples, with <code>diy::RegularSwapPartners</code> being used for the partners object.</p>
<!---
The figure below illustrates the first two rounds of a reduction of 16 blocks. The first round uses radix 4 while the
second round uses radix 2.

![Swap-reduce](figs/swap-reduce.png)
--->

<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">Block</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w">                                  </span><span class="c1">// local block</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="n">diy</span><span class="o">::</span><span class="n">ReduceProxy</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rp</span><span class="p">,</span><span class="w">                </span><span class="c1">// communication proxy</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="n">diy</span><span class="o">::</span><span class="n">RegularSwapPartners</span><span class="o">&amp;</span><span class="p">);</span><span class="w">          </span><span class="c1">// partners of the current block</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="p">{</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">    </span><span class="c1">// partners for swap over regular block grid</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">    </span><span class="n">diy</span><span class="o">::</span><span class="n">RegularSwapPartners</span><span class="w">   </span><span class="n">partners</span><span class="p">(</span><span class="n">decomposer</span><span class="p">,</span><span class="w">  </span><span class="c1">// diy::Decomposer object</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">                                        </span><span class="n">k</span><span class="p">,</span><span class="w">           </span><span class="c1">// radix of k-ary reduction (default 2)</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">                                        </span><span class="n">contiguous</span><span class="p">);</span><span class="w"> </span><span class="c1">// contiguous = true: distance doubling (default true)</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">                                                     </span><span class="c1">// contiguous = false: distance halving</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="w">    </span><span class="c1">// reduction</span>
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#__codelineno-2-15"></a><span class="w">    </span><span class="n">diy</span><span class="o">::</span><span class="n">reduce</span><span class="p">(</span><span class="n">master</span><span class="p">,</span><span class="w">                              </span><span class="c1">// diy::Master object</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#__codelineno-2-16"></a><span class="w">                </span><span class="n">assigner</span><span class="p">,</span><span class="w">                            </span><span class="c1">// diy::Assigner object</span>
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#__codelineno-2-17"></a><span class="w">                </span><span class="n">partners</span><span class="p">,</span><span class="w">                            </span><span class="c1">// diy::RegularSwapPartners object</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#__codelineno-2-18"></a><span class="w">                </span><span class="o">&amp;</span><span class="n">foo</span><span class="p">);</span><span class="w">                               </span><span class="c1">// swap operator callback function</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#__codelineno-2-19"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#__codelineno-2-20"></a><span class="p">}</span>
</code></pre></div>
<p><a href="https://github.com/diatomic/diy/blob/master/examples/reduce/swap-reduce.cpp">see the example here</a></p>
<h2 id="all-reduce">All-reduce</h2>
<p>An all-reduce is a merge-reduce followed by a broadcast of the result from the root block to all of the
blocks, so that all blocks have the same result. The same usage follows from the previous examples, only changing the
partners object. Usage is similar to the previous examples, with the partners class now being
<code>diy::RegularAllReducePartners</code>.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">Block</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w">                                      </span><span class="c1">// local block</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="n">diy</span><span class="o">::</span><span class="n">ReduceProxy</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rp</span><span class="p">,</span><span class="w">                    </span><span class="c1">// communication proxy</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="n">diy</span><span class="o">::</span><span class="n">RegularAllReducePartners</span><span class="o">&amp;</span><span class="p">);</span><span class="w">         </span><span class="c1">// partners of the current block</span>
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="p">{</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="w">    </span><span class="c1">// partners for all-reduce over regular block grid</span>
<a id="__codelineno-3-9" name="__codelineno-3-9" href="#__codelineno-3-9"></a><span class="w">    </span><span class="n">diy</span><span class="o">::</span><span class="n">RegularAllReducePartners</span><span class="w"> </span><span class="n">partners</span><span class="p">(</span><span class="n">decomposer</span><span class="p">,</span><span class="w">  </span><span class="c1">// diy::Decomposer object</span>
<a id="__codelineno-3-10" name="__codelineno-3-10" href="#__codelineno-3-10"></a><span class="w">                                           </span><span class="n">k</span><span class="p">,</span><span class="w">           </span><span class="c1">// radix of k-ary reduction (default 2)</span>
<a id="__codelineno-3-11" name="__codelineno-3-11" href="#__codelineno-3-11"></a><span class="w">                                           </span><span class="n">contiguous</span><span class="p">);</span><span class="w"> </span><span class="c1">// contiguous = true: distance doubling (default true)</span>
<a id="__codelineno-3-12" name="__codelineno-3-12" href="#__codelineno-3-12"></a><span class="w">                                                        </span><span class="c1">// contiguous = false: distance halving</span>
<a id="__codelineno-3-13" name="__codelineno-3-13" href="#__codelineno-3-13"></a>
<a id="__codelineno-3-14" name="__codelineno-3-14" href="#__codelineno-3-14"></a><span class="w">    </span><span class="c1">// reduction</span>
<a id="__codelineno-3-15" name="__codelineno-3-15" href="#__codelineno-3-15"></a><span class="w">    </span><span class="n">diy</span><span class="o">::</span><span class="n">reduce</span><span class="p">(</span><span class="n">master</span><span class="p">,</span><span class="w">                                 </span><span class="c1">// diy::Master object</span>
<a id="__codelineno-3-16" name="__codelineno-3-16" href="#__codelineno-3-16"></a><span class="w">                </span><span class="n">assigner</span><span class="p">,</span><span class="w">                               </span><span class="c1">// diy::Assigner object</span>
<a id="__codelineno-3-17" name="__codelineno-3-17" href="#__codelineno-3-17"></a><span class="w">                </span><span class="n">partners</span><span class="p">,</span><span class="w">                               </span><span class="c1">// diy::RegularAllReducePartners object</span>
<a id="__codelineno-3-18" name="__codelineno-3-18" href="#__codelineno-3-18"></a><span class="w">                </span><span class="o">&amp;</span><span class="n">foo</span><span class="p">);</span><span class="w">                                  </span><span class="c1">// all-reduce operator callback function</span>
<a id="__codelineno-3-19" name="__codelineno-3-19" href="#__codelineno-3-19"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-3-20" name="__codelineno-3-20" href="#__codelineno-3-20"></a><span class="p">}</span>
</code></pre></div>
<h2 id="all-to-all">All-to-all</h2>
<p>The previous examples followed a common pattern. All-to-all is the exception. In an all-to-all reduction, each
block sends and receives from every other block. Even though all-to-all is implemented with a
reduction tree, it is called as if there were a single round of direct communication between all blocks.
This means there is no partners object, and the callback function is written as if there were a
single round with access to all blocks through the <code>ReduceProxy</code>. However, the radix <code>k</code> of the k-ary underlying
implementation is still supplied (defaults to 2).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(</span><span class="n">Block</span><span class="o">*</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w">                                          </span><span class="c1">// local block</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">         </span><span class="k">const</span><span class="w"> </span><span class="n">diy</span><span class="o">::</span><span class="n">ReduceProxy</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rp</span><span class="p">)</span><span class="w">                        </span><span class="c1">// communication proxy</span>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="p">{</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="c1">// outgoing</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">rp</span><span class="p">.</span><span class="n">in_link</span><span class="p">().</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">        </span><span class="c1">// enqueue data to the correct blocks</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">dest_gid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">...</span><span class="w">                                  </span><span class="c1">// destination block global ID</span>
<a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">        </span><span class="n">diy</span><span class="o">::</span><span class="n">BlockID</span><span class="w"> </span><span class="n">dest</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rp</span><span class="p">.</span><span class="n">out_link</span><span class="p">().</span><span class="n">target</span><span class="p">(</span><span class="n">dest_gid</span><span class="p">);</span><span class="w"> </span><span class="c1">// need a full BlockID; out_link targets are ordered as gids</span>
<a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">        </span><span class="n">rp</span><span class="p">.</span><span class="n">enqueue</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">    </span><span class="c1">// incoming</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">    </span><span class="k">else</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">    </span><span class="p">{</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">rp</span><span class="p">.</span><span class="n">in_link</span><span class="p">().</span><span class="n">size</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">        </span><span class="p">{</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">            </span><span class="kt">int</span><span class="w"> </span><span class="n">gid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rp</span><span class="p">.</span><span class="n">in_link</span><span class="p">().</span><span class="n">target</span><span class="p">(</span><span class="n">i</span><span class="p">).</span><span class="n">gid</span><span class="p">;</span>
<a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">            </span><span class="n">diy</span><span class="o">::</span><span class="n">MemoryBuffer</span><span class="o">&amp;</span><span class="w"> </span><span class="n">incoming</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">rp</span><span class="p">.</span><span class="n">incoming</span><span class="p">(</span><span class="n">gid</span><span class="p">);</span>
<a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a><span class="w">            </span><span class="c1">// copy incoming to the block</span>
<a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="w">            </span><span class="p">...</span>
<a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="p">}</span>
<a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a>
<a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">argc</span><span class="p">,</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">argv</span><span class="p">[])</span>
<a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="p">{</span>
<a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">    </span><span class="n">diy</span><span class="o">::</span><span class="n">all_to_all</span><span class="p">(</span><span class="n">master</span><span class="p">,</span><span class="w">                                 </span><span class="c1">// diy::Master object</span>
<a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">                    </span><span class="n">assigner</span><span class="p">,</span><span class="w">                               </span><span class="c1">// diy::Assigner object</span>
<a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">                    </span><span class="o">&amp;</span><span class="n">foo</span><span class="p">,</span><span class="w">                                   </span><span class="c1">// all-to-all operator callback function</span>
<a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">                    </span><span class="n">k</span><span class="p">);</span><span class="w">                                     </span><span class="c1">// radix of k-ary underlying implementation (default 2)</span>
<a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">    </span><span class="p">...</span>
<a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="p">}</span>
</code></pre></div>
<p><a href="https://github.com/diatomic/diy/blob/master/examples/reduce/all-to-all.cpp">see the example here</a></p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>