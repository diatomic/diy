
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://example.com/examples/">
      
      
        <link rel="prev" href="../threads/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.0.5">
    
    
      
        <title>Examples - DIY</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.558e4712.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="DIY" class="md-header__button md-logo" aria-label="DIY" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DIY
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Examples
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="DIY" class="md-nav__button md-logo" aria-label="DIY" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    DIY
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../initialization/" class="md-nav__link">
        Initialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../decomposition/" class="md-nav__link">
        Domain decomposition
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../callbacks/" class="md-nav__link">
        Callback functions
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" tabindex="0" aria-expanded="false">
          Communication
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Communication" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Communication
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../local_comm/" class="md-nav__link">
        Local synchronous communication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../remote_comm/" class="md-nav__link">
        Remote communication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../async_comm/" class="md-nav__link">
        Asynchronous communication
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../reduce_comm/" class="md-nav__link">
        Global communication (reductions)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../io/" class="md-nav__link">
        Block I/O
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../serialization/" class="md-nav__link">
        Serialization
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../mpi/" class="md-nav__link">
        MPI convenience wrapper
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/" class="md-nav__link">
        Algorithms
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../ooc/" class="md-nav__link">
        Writing out-of-core algorithms
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../threads/" class="md-nav__link">
        Automatic block threading
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Examples
      </a>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<p>The best way to learn DIY is by example, and the examples directory contains
numerous complete programs that demonstrate most of the concepts in DIY.
Example names preceded by the heading (<em>commented</em>) have ample comments
embedded in the source code, meaning they are good starting points. The
remaining, uncommented examples are easier to understand once the commented
ones are clear.</p>
<ul>
<li>
<p><a href="https://github.com/diatomic/diy/tree/master/examples/simple">Simple</a>:
  includes common operations such as initializing DIY, adding links to form block
  neighborhoods, creating callback functions for each block, communicating
  between block neighbors, performing collectives over all blocks, and writing
  and reading blocks to and from a DIY file. These examples also show how to
  create, destroy, and serialize blocks in (<em>commented</em>) <a href="https://github.com/diatomic/diy/tree/master/examples/simple/block.h">block.h</a>.</p>
<ul>
<li>
<p>(<em>commented</em>) <a href="https://github.com/diatomic/diy/blob/master/examples/simple/simple.cpp">simple.cpp</a>: exercises
simple neighbor communication by creating a linear chain of blocks, each
connected to two neighbors (predecessor and successor), except for the
first and the last blocks, which have only one or the other. Each block
computes an average of its values and those of its neighbors. The average is
stored in the block, and the blocks are written to a file in storage.</p>
</li>
<li>
<p><a href="https://github.com/diatomic/diy/blob/master/examples/simple/until-done.cpp">until-done.cpp</a>: shows how to use
collectives in the DIY model, i.e., block-based collectives that can run
in-/out-of-core and single/multithreaded. The same result can be
accomplished using the reduction patterns in
<a href="https://github.com/diatomic/diy/tree/master/examples/reduce">examples/reduce</a>,
but using DIY collectives can be easier for simple "one-line" reductions
such as global sums or boolean ands. This example shows how to do an all_reduce()
in order to determine whether all blocks have finished processing.</p>
</li>
<li>
<p><a href="https://github.com/diatomic/diy/blob/master/examples/simple/read-blocks.cpp">read-blocks.cpp</a>: shows how to read
a DIY file back into memory and create a new DIY master and assignment of
blocks to processes that may be different than when the blocks were written.
The blocks from <a href="https://github.com/diatomic/diy/blob/master/examples/simple/simple.cpp">simple.cpp</a> are read back into
memory from the file, and their values are printed.</p>
</li>
</ul>
</li>
<li>
<p><a href="https://github.com/diatomic/diy/tree/master/examples/decomposition">Decomposition</a>:
  demonstrates how to decompose a regular grid into blocks and create links between them.</p>
<ul>
<li>
<p>(<em>commented</em>) <a href="https://github.com/diatomic/diy/blob/master/examples/decomposition/regular-decomposer-long.cpp">regular-decomposer-long.cpp</a>:
blocks are defined via a lambda function provided to the decomposer. This
example shows how to set shared faces, ghost regions, and periodic boundaries
in the decomposition. It also shows both how to create a <code>RegularDecomposer</code>
and call its <code>decompose</code> member function, as well as how to combine those two
steps using one helper function.</p>
</li>
<li>
<p>(<em>commented</em>) <a href="https://github.com/diatomic/diy/blob/master/examples/decomposition/regular-decomposer-short.cpp">regular-decomposer-short.cpp</a>:
domain can be decomposed just by providing a <code>Master</code> object to the
decomposer.</p>
</li>
</ul>
</li>
<li>
<p><a href="https://github.com/diatomic/diy/tree/master/examples/serialization">Serialization</a>:
  blocks that are loaded and saved in and out of core are serialized by DIY. This
  example shows how to write the <code>load</code> and <code>save</code> functions for two data
  structures. Both require just a one-line definition because DIY can serialize
  such structures automatically.</p>
<ul>
<li><a href="https://github.com/diatomic/diy/blob/master/examples/serialization/test-serialization.cpp">test-serialization.cpp</a>:
a 3-d <code>Point</code> and an n-d <code>PointVec</code> are serialized automatically, and the
main program tests loading and saving both structures.</li>
</ul>
</li>
<li>
<p><a href="https://github.com/diatomic/diy/tree/master/examples/mpi">MPI</a>:
  shows DIY's convenience wrapper for MPI. It exists only to make the
  code simpler; the user is free to use it or the original MPI routines
  interchangeably.</p>
<ul>
<li><a href="https://github.com/diatomic/diy/blob/master/examples/mpi/test-mpi.cpp">test-mpi.cpp</a>: this example exercises <code>send</code>,
<code>receive</code>, <code>iprobe</code>, <code>broadcast</code>, <code>reduce</code>, <code>scan</code>, and <code>all_gather</code>.</li>
</ul>
</li>
<li>
<p><a href="https://github.com/diatomic/diy/tree/master/examples/io">I/O</a>: illustrates
  BOV (brick of values) and NumPy I/O, both built on top of MPI-IO and MPI
  sub-array types.</p>
<ul>
<li><a href="https://github.com/diatomic/diy/blob/master/examples/io/test-io.cpp">test-io.cpp</a>: tests the readers and writers for
BOV and NumPy. The reader would typically be called from the <code>create</code>
callback passed to diy::decompose and tell the reader to read a specific
block of data that the decomposer chose. Blocks can read data collectively if
the number of blocks on each processor is the same. Same goes for the
writers. The writer would typically be called from the <code>foreach</code> callback for
each block.</li>
</ul>
</li>
<li>
<p><a href="https://github.com/diatomic/diy/tree/master/examples/reduce">Reduction</a>:
  DIY supports general reductions to implement more complex global operations
  than the collective one-liners. These reductions are general-purpose (any
  global communication pattern can be implemented); they operate over blocks,
  which cycle in and out of core as necessary; the
  operations are (multi-)threaded automatically using the same mechanism as
  <code>diy::Master::foreach()</code>. Although any global communication can
  be expressed using the reduction mechanism, all the reductions included in DIY
  operate in rounds over a k-ary reduction tree. The value of k used in each round
  can vary, but if it's fixed, the number of rounds is log_k(nblocks).</p>
<ul>
<li>
<p>(<em>commented</em>) <a href="https://github.com/diatomic/diy/blob/master/examples/reduce/merge-reduce.cpp">merge-reduce.cpp</a>:
merges blocks together, computing a sum of their values. At each
round, one block of a group of k blocks is the root of the group. The other
blocks send their data to the root, which computes the sum, and the
root block (only) proceeds to the next round. After <code>log_k(numblocks)</code> rounds,
one block contains the global sum of the values. Calling merge-reduce
is done by creating <code>diy::RegularMergePartners</code> and then calling
<code>diy::reduce</code>. For regular grids of blocks, groups can be formed by either
"distance-doubling" or "distance-halving" depending on the value of the
<code>contiguous</code> parameter in <code>diy::RegularMergePartners</code>.</p>
</li>
<li>
<p>(<em>commented</em>) <a href="https://github.com/diatomic/diy/blob/master/examples/reduce/swap-reduce.cpp">swap-reduce.cpp</a>: unlike
merge-reduce, the swap-reduction does not idle blocks from one round to the
next and does not aggregate all the results to a single block. Rather, block
data are split into k pieces that are swapped between the k members of
a group. This particular example begins with an unsorted set of points that
do not lie in the bounds of the blocks, and the swap reduction is used to
sort the points in the correct blocks with respect to the block bounds.</p>
</li>
<li>
<p><a href="https://github.com/diatomic/diy/blob/master/examples/reduce/all-to-all.cpp">all-to-all.cpp</a>: this example solves
the same problem as <a href="https://github.com/diatomic/diy/blob/master/examples/reduce/swap-reduce.cpp">swap-reduce.cpp</a>: sorts
points in blocks. The difference is that
<a href="https://github.com/diatomic/diy/blob/master/examples/reduce/swap-reduce.cpp">swap-reduce.cpp</a> does everything manually;
whereas in <a href="https://github.com/diatomic/diy/blob/master/examples/reduce/all-to-all.cpp">all-to-all.cpp</a>, the user only
specifies how to enqueue data (from each block to each block) at the start
and how to dequeue data at the end. <code>diy::all_to_all()</code> takes care of all the
intermediate rounds, routing the data appropriately.</p>
</li>
<li>
<p>(<em>commented</em>) <a href="https://github.com/diatomic/diy/blob/master/examples/reduce/all-done.cpp">all-done.cpp</a>: this is another example of using
<code>diy::all_to_all()</code> for a very common case: to determine globally whether any blocks have
any local work left to do.</p>
</li>
<li>
<p><a href="https://github.com/diatomic/diy/blob/master/examples/reduce/sort.cpp">sort.cpp</a>: shows how to use reduction to sort
a 1-d vector of integers. The algorithm is a histogram-based sort that
combines both merge and swap reductions. It merges histograms of local data
distributions, computes quantiles of the histograms, and then swaps data
values among blocks based on the quantiles.</p>
</li>
</ul>
</li>
<li>
<p><a href="https://github.com/diatomic/diy/tree/master/examples/reduce">Algorithms</a>:
  Examples of the following algorithms are included.</p>
<ul>
<li>
<p><a href="https://github.com/diatomic/diy/blob/master/examples/reduce/sample-sort.cpp">sample-sort.cpp</a>: This example calls the parallel
sample sort algorithm of [Blelloch 1998] that's included in DIY.
The built-in  <code>diy::sort</code> used in this example is easier to use than
the manual sort implemented by the example above, and we are in the process of comparing the
performance of the two versions. Note that
<a href="\ref reduce/sort.cpp">sort.cpp</a> can only sort arithmetic types (to be able
to compute the histograms), whereas <code>diy::sort</code> supports any type, which has
a user-supplied comparison operation.</p>
</li>
<li>
<p><a href="https://github.com/diatomic/diy/blob/master/examples/reduce/kd-tree.cpp">kd-tree.cpp</a>: Like the swap-reduce example above, this
example begins with an unsorted set of points that do not lie in the bounds
of any blocks, but the points are sorted into kd-tree of blocks with
approximately equal numbers of points in each block.</p>
</li>
</ul>
</li>
</ul>
<p>Various other open-source projects have been DIY'ed, and these are also good, albeit more involved, places to learn DIY. Here are a few suggestions:</p>
<ul>
<li><a href="https://github.com/tpeterka/cian2">cian2</a> is a suite of benchmarks that test
  various HPC tasks. The <a href="https://github.com/tpeterka/cian2/tree/master/communication">communication</a> part of cian
  tests common communication patterns including most of the above reductions and
  neighbor communication.</li>
<li><a href="https://github.com/diatomic/tess2">tess2</a> is a parallel Voronoi and Delaunay tessellation library that is parallelized using DIY.<ul>
<li>The <a href="https://github.com/diatomic/tess2/tree/master/src">src</a> directory is the library code that uses DIY to compute the tessellation in parallel and write it to disk in the DIY block format.</li>
<li>The <a href="https://github.com/diatomic/tess2/tree/master/examples">examples</a> directory contains numerous DIY programs that use the tess library.</li>
<li>The <a href="https://github.com/diatomic/tess2/tree/master/tools">tools</a> directory contains a serial rendering program <code>draw.cpp</code> that reads the DIY block format from disk and uses it to draw the tessellation.</li>
</ul>
</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.e5c33ebb.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.51d95adb.min.js"></script>
      
    
  </body>
</html>